#!/usr/bin/env bash
set -euo pipefail

# 提交前自动跑测试：失败则阻止提交
# 使用方法：先执行一次 scripts/install-githooks.sh 进行安装

repo_root="$(git rev-parse --show-toplevel 2>/dev/null || true)"
if [[ -z "${repo_root}" ]]; then
  echo "[pre-commit] 无法获取仓库根目录（git rev-parse 失败）" >&2
  exit 1
fi

cd "${repo_root}"

echo "[pre-commit] 运行 Go 测试（controller + node-agent）..."
go test ./controller/... ./node-agent/...

echo "[pre-commit] 测试通过，继续提交。"

